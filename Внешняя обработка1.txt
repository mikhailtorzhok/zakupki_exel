
&НаКлиенте
Процедура Рассчитать(Команда)
	Сообщить("Привет, мир");
	МассивКорреспондентов = Новый Массив;
	МассивКорреспондентов = ЗапроситьСписокКонтрагентовНаСервере();
	//тзВСтроке = ЗапроситьСписокКонтрагентовНаСервере();
	Сообщить("Возврат Корреспондентов");
	//тз = ЗначениеИзСтрокиВнутр(тзВСтроке);
	//Сообщить(СтрДлина(тзВСтроке));
	//Сообщить ("Успешное восстановление таблицы из строки");	
	//Сообщить(МассивКорреспондентов[0]);
	i=0;
	Для Каждого Корреспондент Из МассивКорреспондентов Цикл
        Сообщить(Корреспондент);
		сообщить(Корреспондент.количество());
		//НапечататьТаблицуКорреспондентов(Корреспондент);	
		Сообщить("Корреспондент.Ссылка" + " = " + Корреспондент.Ссылка);
		Сообщить("Корреспондент.ИНН" + " = " + Корреспондент.ИНН);
		Сообщить("Корреспондент.ФизЛицо" + " = " + Корреспондент.ФизЛицо);
		Сообщить("Корреспондент.ВидКорреспондента" + " = " + Корреспондент.ВидКорреспондента);
		Сообщить("Корреспондент.ПолноеНаименование" + " = " + Корреспондент.ПолноеНаименование);
        Сообщить("Корреспондент.КПП" + " = " + Корреспондент.КПП);
        Сообщить("Корреспондент.КодПоОКПО" + " = " + Корреспондент.КодПоОКПО);
		Сообщить("Корреспондент.ГруппаДоступа" + " = " + Корреспондент.ГруппаДоступа);
		Сообщить("Корреспондент.Комментарий" + " = " + Корреспондент.Комментарий);
		//Сообщить("Корреспондент.НомерТелефона" + " = " + Корреспондент.НомерТелефона);
		i=i+1;
		Если i>=2 Тогда
            Прервать;
        КонецЕсли;
	КонецЦикла;
	ЗаписатьДанныеВФайлCSV(Команда, МассивКорреспондентов)

	
КонецПроцедуры



 &НаСервере
Функция ЗапроситьСписокКонтрагентовНаСервере()
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Корреспонденты.Ссылка КАК Ссылка,
		|	Корреспонденты.ИНН КАК ИНН,
		|	Корреспонденты.ФизЛицо КАК ФизЛицо,
		|	Корреспонденты.ВидКорреспондента КАК ВидКорреспондента,
		|	Корреспонденты.ПолноеНаименование КАК ПолноеНаименование,
		|	Корреспонденты.КПП КАК КПП,
		|	Корреспонденты.КодПоОКПО КАК КодПоОКПО,	
		|	Корреспонденты.ГруппаДоступа КАК ГруппаДоступа,
		|	Корреспонденты.Комментарий КАК Комментарий
		//|	Корреспонденты.КонтактнаяИнформация.НомерТелефона КАК НомерТелефона
		|ИЗ
		|	Справочник.Корреспонденты КАК Корреспонденты";
	РезультатЗапроса = Запрос.Выполнить();
	ТабКорреспондентов = РезультатЗапроса.Выгрузить();	
	//тзВСтроке = ЗначениеВСтрокуВнутр(ТабКорреспондентов); 	
	Сообщить("Создание таблицы корреспонденты завершено");	
	//Возврат(тзВСтроке);
	
	МассивКорреспондентов = Новый Массив;
	//МассивКонтактнаяИнформация = Новый Массив;
	//МассивКонтактнаяИнформация = ТаблицаЗначенийВМассив1(Корреспонденты.КонтактнаяИнформация.НомерТелефона);

	МассивКорреспондентов = ТаблицаЗначенийВМассив1(ТабКорреспондентов);
	
	
	
	
	Возврат(МассивКорреспондентов);
	
	
	
КонецФункции


&НаКлиенте
Процедура ЗаписатьCSV(ТекстФайла, ИмяФайла)
		
	КодировкаФайла 	= КодировкаТекста.Системная;
	ТекстовыйФайлЗапись = Новый ЗаписьТекста(ИмяФайла, КодировкаФайла);           
	ТекстовыйФайлЗапись.ЗаписатьСтроку(ТекстФайла);
	ТекстовыйФайлЗапись.Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаписатьДанныеВФайлCSV(Команда, ДанныеДляЗаписиМассив)
	ФайлЗаписиДанных = "d://Корреспонденты.csv";
	Если Не ЗначениеЗаполнено(ФайлЗаписиДанных) Тогда
		Возврат;
	КонецЕсли;	
	
	ТекстФайлаCSV = "";
	СимволРазделителя = ",";
	
	//Если хотим добавить строку заголовков, то добавим строку
	ТекстФайлаCSV = "ПолноеНаименование"+ СимволРазделителя + "Ссылка"+ СимволРазделителя + 
	"ВидКорреспондента"+ СимволРазделителя + "ФизЛицо"+ СимволРазделителя +
	"ИНН"+ СимволРазделителя + "КПП"+ СимволРазделителя +
	"КодПоОКПО"+ СимволРазделителя + "ГруппаДоступа"+ СимволРазделителя +
	"Комментарий" + Символы.ПС;
	
	Для Каждого ТекСтрока Из ДанныеДляЗаписиМассив Цикл
		ТекстФайлаCSV = ТекстФайлаCSV + ТекСтрока.ПолноеНаименование + СимволРазделителя + 
										ТекСтрока.Ссылка + СимволРазделителя + 
										ТекСтрока.ВидКорреспондента + СимволРазделителя + 
										ТекСтрока.ФизЛицо + СимволРазделителя +
										ТекСтрока.ИНН + СимволРазделителя +
										ТекСтрока.КПП + СимволРазделителя +
										ТекСтрока.КодПоОКПО + СимволРазделителя +
										ТекСтрока.ГруппаДоступа + СимволРазделителя +
										ТекСтрока.Комментарий + СимволРазделителя +
										Символы.ПС;
										//Строка(ТекСтрока.ДатаРождения) + Символы.ПС;
	КонецЦикла;
	
	//ТекстФайлаCSV = Лев(ТекстФайлаCSV, СтрДлина(ТекстФайлаCSV) - 1);
	
	Попытка
		ЗаписатьCSV(ТекстФайлаCSV, ФайлЗаписиДанных)
	Исключение
	КонецПопытки;
	
КонецПроцедуры




&НаСервере
Функция ТаблицаЗначенийВМассив1(ТаблицаЗначений) 
    
    Массив = Новый Массив();
    СтруктураСтрокой = "";
    НужнаЗапятая = Ложь;
    Для Каждого Колонка Из ТаблицаЗначений.Колонки Цикл
        Если НужнаЗапятая Тогда
            СтруктураСтрокой = СтруктураСтрокой + ",";
        КонецЕсли;
        СтруктураСтрокой = СтруктураСтрокой + Колонка.Имя;
        НужнаЗапятая = Истина;
    КонецЦикла;
    Для Каждого Строка Из ТаблицаЗначений Цикл
        НоваяСтрока = Новый Структура(СтруктураСтрокой);
        ЗаполнитьЗначенияСвойств(НоваяСтрока, Строка);
        Массив.Добавить(НоваяСтрока);
    КонецЦикла;
    Возврат Массив;

КонецФункции


	
			 


